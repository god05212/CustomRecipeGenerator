import os
import streamlit as st
from openai import OpenAI

# í˜ì´ì§€ ê¸°ë³¸ ì„¤ì •
st.set_page_config(page_title="ğŸ’¡ ë¶„ì•¼ë³„ ì•„ì´ë””ì–´ ìƒì„±ê¸°", page_icon="ğŸ’¡", layout="wide")
st.title("ğŸ’¡ ë¶„ì•¼ë³„ ì•„ì´ë””ì–´ ìƒì„±ê¸° (Streamlit)")

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# API í‚¤ ì…ë ¥ ë° ì„¤ì •
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ì‚¬ìš©ìë¡œë¶€í„° API í‚¤ ì…ë ¥ ë°›ê¸°
api_key = st.text_input("ğŸ”‘ OpenAI API Keyë¥¼ ì…ë ¥í•˜ì„¸ìš”:", type="password")

# API í‚¤ê°€ ì…ë ¥ë˜ì—ˆëŠ”ì§€ í™•ì¸
if not api_key:
    st.warning("OpenAI API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.")
    st.stop() # API í‚¤ ì—†ìœ¼ë©´ ì•± ì‹¤í–‰ ì¤‘ì§€

try:
    client = OpenAI(api_key=api_key)
except Exception as e:
    st.error(f"âŒ API í‚¤ ì„¤ì • ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {e}")
    st.stop()

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ì•„ì´ë””ì–´ ìƒì„± í•¨ìˆ˜ (ì›ë˜ Gradioì˜ generate_ideasë¥¼ ê·¸ëŒ€ë¡œ í¬íŒ…)
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
def generate_ideas(topic: str, count: int, temperature: float = 0.8) -> str:
    if not topic.strip():
        return "âŒ ì£¼ì œë¥¼ ì…ë ¥í•˜ì„¸ìš”."
    prompt = (
        f"'{topic}' ë¶„ì•¼ì—ì„œ ìƒˆë¡œìš´ ì•„ì´ë””ì–´ë¥¼ {count}ê°œ ì‘ì„±í•´ ì£¼ì„¸ìš”.\n"
        "ê° ì•„ì´ë””ì–´ëŠ” ê°„ê²°í•˜ê³  ì°½ì˜ì ìœ¼ë¡œ ì‘ì„±í•˜ë©°, ë²ˆí˜¸ë¥¼ ë¶™ì—¬ ì£¼ì„¸ìš”."
    )
    try:
        res = client.chat.completions.create(
            model="gpt-3.5-turbo",
            messages=[
                {"role": "system", "content": "ë‹¹ì‹ ì€ ì°½ì˜ì ì¸ ì•„ì´ë””ì–´ë¥¼ ì œì•ˆí•˜ëŠ” ì „ë¬¸ê°€ì…ë‹ˆë‹¤."},
                {"role": "user", "content": prompt},
            ],
            temperature=temperature,
        )
        return (res.choices[0].message.content or "").strip()
    except Exception as e:
        return f"âš ï¸ ì˜¤ë¥˜ ë°œìƒ: {e}"

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Streamlit UI
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
with st.sidebar:
    st.header("âš™ï¸ ì„¤ì •")
    topic = st.text_input("ì£¼ì œ", placeholder="ì˜ˆ: êµìœ¡, í—¬ìŠ¤ì¼€ì–´, í™˜ê²½ ë³´í˜¸ ë“±", value="êµìœ¡")
    count = st.slider("ì•„ì´ë””ì–´ ê°œìˆ˜", min_value=1, max_value=10, value=3, step=1)
    temperature = st.slider("ì°½ì˜ì„±(temperature)", 0.0, 1.2, 0.8, 0.1)
    run = st.button("ì•„ì´ë””ì–´ ìƒì„±")

st.markdown("ì£¼ì œì™€ ê°œìˆ˜ë¥¼ ì„¤ì •í•œ ë’¤ **ì‚¬ì´ë“œë°”ì˜ ë²„íŠ¼**ì„ ëˆ„ë¥´ì„¸ìš”.")

if run:
    with st.status("ì•„ì´ë””ì–´ ìƒì„± ì¤‘...", expanded=False):
        ideas_md = generate_ideas(topic, count, temperature)
    st.subheader("ğŸ“ ê²°ê³¼")
    st.markdown(ideas_md)
